<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SKE í†µí•© ê´€ë¦¬ SYSTEM</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { 
            --erp-primary: #1e293b; --erp-accent: #3b82f6; --erp-bg: #f8fafc;
            --status-red: #ef4444; --status-brown: #9a3412; --status-yellow: #eab308; --status-green: #10b981;
        }
        body { font-family: 'Pretendard', sans-serif; background: var(--erp-bg); margin: 0; color: #1e293b; }
        .header { background: var(--erp-primary); display: flex; align-items: center; padding: 0 40px; height: 64px; position: sticky; top: 0; z-index: 2000; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .logo { color: white; font-weight: 900; font-size: 20px; margin-right: 50px; }
        .nav-btn { background: none; border: none; color: #94a3b8; font-weight: 700; font-size: 14px; padding: 0 20px; cursor: pointer; height: 100%; transition: 0.3s; }
        .nav-btn.active { color: white; background: rgba(255,255,255,0.1); box-shadow: inset 0 -4px 0 var(--erp-accent); }
        .container { max-width: 1650px; margin: 30px auto; padding: 0 30px; box-sizing: border-box; }
        .page-content { display: none; }
        .page-content.active { display: block; }
        
        /* í…Œì´ë¸” ê³µí†µ ìŠ¤íƒ€ì¼ */
        table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; }
        th { background: #f8fafc; padding: 12px; color: #64748b; font-size: 12px; border-bottom: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; }
        td { padding: 10px; text-align: center; border-bottom: 1px solid #f1f5f9; border-right: 1px solid #f1f5f9; font-size: 13px; font-weight: 600; }
        
        /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
        .input-section { background: #fff; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #e2e8f0; }
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; }
        input, select { padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; font-weight: 700; width: 100%; background: #fcfcfc; box-sizing: border-box; }
        .btn-erp { background: var(--erp-primary); color: white; border: none; padding: 10px 15px; border-radius: 6px; font-weight: 800; cursor: pointer; }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .erp-modal { display: none; position: fixed; z-index: 3000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
        .modal-body { background: white; margin: 2% auto; padding: 40px; border-radius: 8px; width: 90%; max-width: 1000px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        
        /* [ì¤‘ìš”] ì„±ì ì„œ ì¸ì‡„ ì „ìš© ìŠ¤íƒ€ì¼ */
        .inspect-sheet { color: black; line-height: 1.2; }
        .inspect-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .inspect-title { font-size: 28px; font-weight: 900; text-decoration: underline; flex: 1; text-align: center; margin-left: 150px; }
        .approval-table { border-collapse: collapse; margin-bottom: 10px; }
        .approval-table td { width: 60px; height: 60px; border: 1px solid #000; padding: 2px; font-size: 11px; }
        .approval-table .label { background: #f0f0f0; height: 20px; }
        
        .inspect-main-table { width: 100%; border: 2px solid #000; border-collapse: collapse; }
        .inspect-main-table th, .inspect-main-table td { border: 1px solid #000; padding: 8px; font-size: 12px; text-align: center; }
        .inspect-main-table th { background: #f0f0f0; }
        
        @media print {
            .no-print { display: none !important; }
            body { background: white; margin: 0; padding: 0; }
            .container { margin: 0; padding: 0; max-width: 100%; }
            .modal-body { position: absolute; left: 0; top: 0; width: 100%; border: none; box-shadow: none; margin: 0; padding: 10mm; }
        }
    </style>
</head>
<body>

<header class="header no-print">
    <div class="logo">SKE SYSTEM</div>
    <div class="nav-group">
        <button id="nav-stock" class="nav-btn active" onclick="switchPage('stock')">í†µí•© ì¬ê³  ê´€ë¦¬</button>
        <button id="nav-inspection" class="nav-btn" onclick="switchPage('inspection')">ìˆ˜ì…ê²€ì‚¬ì„±ì ì„œ</button>
        <button id="nav-materials" class="nav-btn" onclick="switchPage('materials')">ì‚¬ê¸‰ ìì¬ í˜„í™©</button>
    </div>
</header>

<div class="container no-print">
    <div id="page-stock" class="page-content active">
        <div class="input-section">
            <div class="input-grid">
                <input type="date" id="st-date"><input type="text" id="st-code" placeholder="í’ˆëª©ì½”ë“œ">
                <select id="st-parent">
                    <option value="CABLE">CABLE</option><option value="SLEEVE">SLEEVE</option>
                    <option value="CONNECTOR">CONNECTOR</option><option value="TUBE">TUBE</option>
                </select>
                <input type="text" id="st-item" placeholder="í’ˆëª©ëª…">
                <input type="text" id="st-spec" placeholder="ê·œê²©">
                <input type="text" id="st-vendor" placeholder="ê±°ë˜ì²˜ëª…">
                <select id="st-type"><option value="ì…ê³ ">ì…ê³ </option><option value="ì¶œê³ ">ì¶œê³ </option></select>
                <input type="number" id="st-qty" value="0">
                <button class="btn-erp" onclick="addData('stock')">ë“±ë¡</button>
            </div>
        </div>
        <table id="stock-table">
            <thead><tr><th>ì½”ë“œ</th><th>ë¶„ë¥˜</th><th>í’ˆëª©ëª…</th><th>ê·œê²©</th><th>ì¬ê³ </th><th>ìƒíƒœ</th></tr></thead>
            <tbody id="stock-table-body"></tbody>
        </table>
    </div>

    <div id="page-inspection" class="page-content">
        <div class="input-section">
            <h3 style="margin:0;">ğŸ“‹ ìˆ˜ì…ê²€ì‚¬ ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸</h3>
            <p style="font-size:12px; color:#64748b;">'ì…ê³ ' ë°ì´í„°ê°€ ë“±ë¡ë˜ë©´ ìë™ìœ¼ë¡œ ì„±ì ì„œ ëŒ€ê¸° ëª©ë¡ì— ì¶”ê°€ë©ë‹ˆë‹¤.</p>
        </div>
        <table>
            <thead>
                <tr>
                    <th>ì…ê³ ì¼</th><th>ê±°ë˜ì²˜</th><th>í’ˆëª…/ê·œê²©</th><th>ì…ê³ ëŸ‰</th><th>íŒì •</th><th>ê²€ì‚¬ì</th><th>ê´€ë¦¬</th>
                </tr>
            </thead>
            <tbody id="inspection-table-body"></tbody>
        </table>
    </div>
</div>

<div id="inspectModal" class="erp-modal">
    <div class="modal-body inspect-sheet">
        <div class="inspect-header">
            <div style="font-size:12px;">ì–‘ì‹ë²ˆí˜¸: SKQP08601-01</div>
            <div class="inspect-title">ìˆ˜ ì… ê²€ ì‚¬ ì„± ì  ì„œ</div>
            <table class="approval-table">
                <tr><td rowspan="2" class="label">ê²°ì¬</td><td class="label">ì‘ì„±</td><td class="label">ê²€í† </td><td class="label">ìŠ¹ì¸</td></tr>
                <tr><td><br>ë°• ì›…</td><td></td><td></td></tr>
            </table>
        </div>
        
        <div style="display:flex; justify-content: flex-end; font-size:12px; margin-bottom:5px;">
            ë²”ë¡€: â—‹ (ì–‘í˜¸), X (ë¶ˆëŸ‰)
        </div>

        <table class="inspect-main-table">
            <thead>
                <tr>
                    <th rowspan="2" width="100">ì…ê³ ì¼</th>
                    <th rowspan="2" width="120">ê±°ë˜ì²˜ëª…</th>
                    <th rowspan="2">í’ˆëª…/ê·œê²©</th>
                    <th rowspan="2" width="80">ìˆ˜ëŸ‰</th>
                    <th colspan="6">ê²€ì‚¬í•­ëª© ë° ê²°ê³¼</th>
                    <th rowspan="2" width="80">ê²€ì‚¬ì</th>
                </tr>
                <tr>
                    <th>ì™¸ê´€</th><th>ê·œê²©</th><th>ê°€ê³µ</th><th>ì¡°ë¦½</th><th>íšŒë¡œ</th><th>ìœ í•´ë¬¼ì§ˆ</th>
                </tr>
            </thead>
            <tbody id="m-inspect-rows">
                </tbody>
        </table>

        <div style="margin-top:20px; font-size:12px;">
            <p>* ë¶ˆëŸ‰ì‹œ ì¡°ì¹˜ë‚´ìš©: <span id="m-inspect-fail-note"></span></p>
            <p>* ë¹„ê³ : <span id="m-inspect-memo"></span></p>
        </div>

        <div class="no-print" style="margin-top:30px; display:flex; gap:10px;">
            <button class="btn-erp" style="flex:1; background:#10b981;" onclick="window.print()">ğŸ–¨ï¸ ì„±ì ì„œ ì¸ì‡„</button>
            <button class="btn-erp" style="flex:1;" onclick="closeModal()">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<script>
    const BASE_URL = "https://ske-00003-default-rtdb.firebaseio.com/";
    const STOCK_URL = BASE_URL + "stock_management.json";
    const INSPECT_URL = BASE_URL + "inspection_reports.json";

    let db = { stock: [], inspection: [] };

    async function loadData() {
        const [sRes, iRes] = await Promise.all([fetch(STOCK_URL), fetch(INSPECT_URL)]);
        db.stock = Object.values(await sRes.json() || {});
        const iData = await iRes.json() || {};
        db.inspection = Object.entries(iData).map(([id, val]) => ({...val, id}));
        
        renderStock();
        renderInspection();
    }

    async function addData(type) {
        const ts = Date.now();
        if(type === 'stock') {
            const date = document.getElementById('st-date').value;
            const item = document.getElementById('st-item').value;
            const spec = document.getElementById('st-spec').value;
            const vendor = document.getElementById('st-vendor').value;
            const flow = document.getElementById('st-type').value;
            const qty = Number(document.getElementById('st-qty').value);

            const stockEntry = { date, code: document.getElementById('st-code').value, parent: document.getElementById('st-parent').value, item, spec, vendor, type: flow, qty, timestamp: ts };
            
            await fetch(STOCK_URL.replace('.json', `/${ts}.json`), { method: 'PUT', body: JSON.stringify(stockEntry) });

            // [ìë™í™”] 'ì…ê³ 'ì¼ ê²½ìš° ì„±ì ì„œì— ìë™ ì¶”ê°€
            if(flow === 'ì…ê³ ') {
                const inspectEntry = { date, vendor, item, spec, qty, inspector: 'ë°• ì›…', result: 'OK', results: {å¤–ê´€:'â—‹', è¦ê²©:'â—‹', åŠ ê³µ:'â—‹', çµ„ë¦½:'â—‹', å›ë¡œ:'â—‹', ìœ í•´:'â—‹'}, timestamp: ts };
                await fetch(INSPECT_URL.replace('.json', `/${ts}.json`), { method: 'PUT', body: JSON.stringify(inspectEntry) });
            }
        }
        loadData();
    }

    function renderInspection() {
        const tbody = document.getElementById('inspection-table-body');
        tbody.innerHTML = db.inspection.sort((a,b) => b.timestamp - a.timestamp).map(i => `
            <tr>
                <td>${i.date}</td><td>${i.vendor}</td><td>${i.item} / ${i.spec}</td>
                <td>${i.qty.toLocaleString()}</td><td><span style="color:green">â— ì–‘í˜¸</span></td><td>${i.inspector}</td>
                <td><button class="btn-erp" onclick="openInspectReport('${i.id}')">ì„±ì ì„œ ì—´ê¸°</button></td>
            </tr>
        `).join('');
    }

    function openInspectReport(id) {
        const i = db.inspection.find(x => x.id === id);
        const rowHtml = `
            <tr>
                <td>${i.date}</td><td>${i.vendor}</td><td>${i.item}<br>${i.spec}</td><td>${i.qty}</td>
                <td>${i.results.å¤–ê´€}</td><td>${i.results.è¦ê²©}</td><td>${i.results.åŠ ê³µ}</td>
                <td>${i.results.çµ„ë¦½}</td><td>${i.results.å›ë¡œ}</td><td>${i.results.ìœ í•´}</td>
                <td>${i.inspector}</td>
            </tr>
        `;
        document.getElementById('m-inspect-rows').innerHTML = rowHtml;
        document.getElementById('inspectModal').style.display = 'block';
    }

    function renderStock() {
        const sum = {};
        db.stock.forEach(d => {
            const k = d.item + '|' + d.spec;
            if(!sum[k]) sum[k] = { code: d.code, name: d.item, spec: d.spec, q: 0, p: d.parent };
            sum[k].q += (d.type === 'ì¶œê³ ' ? -Number(d.qty) : Number(d.qty));
        });
        document.getElementById('stock-table-body').innerHTML = Object.values(sum).map(s => `
            <tr><td>${s.code}</td><td>${s.p}</td><td>${s.name}</td><td>${s.spec}</td><td>${s.q.toLocaleString()}</td><td>ì–‘í˜¸</td></tr>
        `).join('');
    }

    function switchPage(p) {
        document.querySelectorAll('.page-content').forEach(x => x.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(x => x.classList.remove('active'));
        document.getElementById('page-' + p).classList.add('active');
        document.getElementById('nav-' + p).classList.add('active');
    }

    function closeModal() { document.getElementById('inspectModal').style.display = 'none'; }
    window.onload = () => {
        document.querySelectorAll('input[type="date"]').forEach(i => i.value = new Date().toISOString().split('T')[0]);
        loadData();
    };
</script>
</body>
</html>
